#macro( substr $text $length)
	#if($text.length() > $length)
		#set( $endIndex = $length - 1)
		$text.substring(0, $endIndex)...
	#else
		$text
	#end
#end

#macro( getCauseName $cause)
	#if($cause.getTransfer() == 0)
		Cause $cause.getCauseNumber() - #substr( $cause.getTitle() 50)
	#else
		#set ($theCause = $transferredCauses.get($cause.getID()))
		#if ($theCause.getMovedProject())
			&lt;The transfer target is in another JIRA project: $theCause.getMovedProject()&gt;
	    #else
			#if ($theCause.getTransferTargetType() == "CAUSE")
				#if (!$theCause.getTargetHazardNumber() || !$theCause.getTargetHazardNumber() == "")
					Cause $cause.getCauseNumber() (TRANSFER) - &lt;Hazard id=$theCause.getTargetHazardID()&gt;:CAUSE $theCause.getTargetCauseNumber() - #substr($theCause.getTargetCauseTitle() 50)
				#else
					Cause $cause.getCauseNumber() (TRANSFER) - $theCause.getTargetHazardNumber():CAUSE $theCause.getTargetCauseNumber() - #substr($theCause.getTargetCauseTitle() 50)
				#end
			#else
				#if(!$theCause.getTargetHazardNumber() || !$theCause.getTargetHazardNumber() == "")
					Cause $cause.getCauseNumber() (TRANSFER) - &lt;Hazard id=$theCause.getTargetHazardID()&gt;:&lt;ALL CAUSES&gt;
				#else
					Cause $cause.getCauseNumber() (TRANSFER) - $theCause.getTargetHazardNumber():&lt;ALL CAUSES&gt;
				#end
			#end
		#end
	#end
#end

#macro( getControlName $control)
	#set( $causeNum = "Orph" )
	#set( $causes = $control.getCauses())
	#foreach( $cause in $causes)
		#set( $causeNum = $cause.getCauseNumber() )
		#break
	#end	
	Control $causeNum.$control.getControlNumber() -
	#if($control.getTransfer() == 0)
		#substr($control.getDescription() 60)
	#else
		#set ($theControl = $transferredControls.get($control.getID()))
		#set( $targetCauseNum = "Orph")
		#if ( $theControl.getTargetCauseNumber() > 0)
			$targetCauseNum = $theControl.getTargetCauseNumber()
		#end
		#if ($theControl.getMovedProject())
			(TRANSFER) &lt;The transfer target is in another JIRA project: $theControl.getMovedProject()&gt;
		#else	
			#if ($theControl.getTransferTargetType() == "CONTROL")
				#if ($theControl.isDeleted() == true)
						#if(!$theControl.getTargetHazardNumber() || $theControl.getTargetHazardNumber() == "")
							(TRANSFER) &lt;Hazard id=$theControl.getTargetHazardID()&gt;:CONTROL $targetCauseNum.$theControl.getTargetControlNumber() - #substr($theControl.getTargetControlDescription() 55)
						#else
							(TRANSFER) $theControl.getTargetHazardNumber():CONTROL $targetCauseNum.$theControl.getTargetControlNumber() - #substr($theControl.getTargetControlDescription() 55)
						#end
				#else
					<a href="controls?id=$!theControl.getTargetHazardID()" targetID="$!theControl.getTargetID()" targetType="$!theControl.getTransferTargetType()" class="controlTransferLink">
						#if (!$theControl.getTargetHazardNumber() || $theControl.getTargetHazardNumber() == "")
							(TRANSFER) &lt;Hazard id=$theControl.getTargetHazardID()&gt;:CONTROL $targetCauseNum.$theControl.getTargetControlNumber() - #substr($theControl.getTargetControlDescription() 55)
						#else
							(TRANSFER) $theControl.getTargetHazardNumber():CONTROL $targetCauseNum.$theControl.getTargetControlNumber() - #substr($theControl.getTargetControlDescription() 55)
						#end
					</a>
				#end
			#else
				#if ($theControl.isDeleted() == true)
						#if(!$theControl.getTargetHazardNumber() || $theControl.getTargetHazardNumber() == "")
							(TRANSFER) &lt;Hazard id=$theControl.getTargetHazardID()&gt;:CAUSE $targetCauseNum - #substr($theControl.getTargetCauseTitle() 60)
						#else
							(TRANSFER) $theControl.getTargetHazardNumber():CAUSE $targetCauseNum - #substr($theControl.getTargetCauseTitle() 60)
						#end
				#else
					<a href="causes?id=$!theControl.getTargetHazardID()" targetID="$!theControl.getTargetID()" targetType="$!theControl.getTransferTargetType()" class="controlTransferLink">
						#if (!$theControl.getTargetHazardNumber() || $theControl.getTargetHazardNumber()== "")
								(TRANSFER) &lt;Hazard id=$theControl.getTargetHazardID()&gt;:All controls for CAUSE $targetCauseNum - #substr($theControl.getTargetCauseTitle() 60)
						#else
								(TRANSFER) $!theControl.getTargetHazardNumber():All controls for CAUSE $targetCauseNum - #substr($theControl.getTargetCauseTitle() 60)
						#end
					</a>
				#end
			#end
		#end
	#end
#end

<html>
	<head>
		<title>HTS</title>
		<meta name="decorator" content="atl.general">
		$webResourceManager.requireResourcesForContext("HTSContext")
	</head>
	<body class="aui-layout aui-theme-default">
		#parse("/templates/general-navigation.vm")
		<div id="MainContent">
			<div id="ContentHolder">
				#parse("/templates/hazard-page-mission-hazard-nav.vm")
				#parse("/templates/hazard-page-prop-nav.vm")
				<div class="aui-page-panel">
					<div class="aui-page-panel-inner">
						<section class="aui-page-panel-content">
							#if ($verifications.size() == 0)
								<p>No Verifications have been created for this Hazard Report.</p>
							#else
								<div class="verificationListHeader">
									<span class="headerDescription">Title</span>
									<span class="headerDate">Last updated</span>
									<span class="headerDelete"><div class="HazardPropertyTableCell6Img"></div></span>
								</div>
								<ul id="verificationsList">
									#foreach ($cause in $causes)
										#if(!$cause.getDeleteReason() )
										#set( $numControls = 0 )
										
										#foreach ($control in $cause.getControls())
											#if( !$control.getDeleteReason() || $control.getDeleteReason().isEmpty() )
												#set( $numControls = $numControls + 1 )
											#end
										#end
										<li>
											 <div class="causeHeader" id="CauseTableEntryID$cause.getID()">
												<span class="VerificationCauseTableToggle aui-icon aui-icon-small aui-iconfont-devtools-task-disabled">Expand/collapse this cause</span>
												<span class="causeNumber"><a href="causes?id=$hazard.getID()#causeID$cause.getID()" causeID="$cause.getID()">Cause $cause.getCauseNumber()</a> ($numControls)</span>
												<span class="causeTitle">
													#if($cause.getTransfer() == 0)
														#substr( $cause.getTitle(), 75)
													#else
														#set ($theCause = $transferredCauses.get($cause.getID()))
													    #if ($theCause.getMovedProject())
															(TRANSFER) &lt;The transfer target is in another JIRA project: $theCause.getMovedProject()&gt;
														#else
															#if ($theCause.getTransferTargetType() == "CAUSE")
																#if ($theCause.isDeleted() == true)
																	<div class="HTSTransferDeletedOrigin">
																		#if (!$theCause.getTargetHazardNumber() || !$theCause.getTargetHazardNumber() == "")
																				(TRANSFER) &lt;Hazard id=$theCause.getTargetHazardID()&gt;:CAUSE $theCause.getTargetCauseNumber() -  #substr( $theCause.getTargetCauseTitle(), 60)
																		#else
																				(TRANSFER) $theCause.getTargetHazardNumber():CAUSE $theCause.getTargetCauseNumber() -  #substr( $theCause.getTargetCauseTitle(), 60)
																		#end
																		 
																	</div>
																#else
																	<a href="causes?id=$!theCause.getTargetHazardID()" originID="$!theCause.getOriginID()" targetID="$!theCause.getTargetID()" class="transferLink" >
																		#if (!$theCause.getTargetHazardNumber() || !$theCause.getTargetHazardNumber() == "")
																				(TRANSFER) &lt;Hazard id=$theCause.getTargetHazardID()&gt;:CAUSE $theCause.getTargetCauseNumber() - #substr( $theCause.getTargetCauseTitle(), 60)
																		#else
																				(TRANSFER) $theCause.getTargetHazardNumber():CAUSE $theCause.getTargetCauseNumber() - #substr($theCause.getTargetCauseTitle(), 60)
																		#end
																	</a>
																#end
															#else
																#if ($theCause.isDeleted() == true)
																	<div class="HTSTransferDeletedOrigin">
																#else
																	<a href="hazards?id=$!theCause.getTargetHazardID()">
																#end
																	
																#if(!$theCause.getTargetHazardNumber() || !$theCause.getTargetHazardNumber() == "")
																	(TRANSFER) &lt;Hazard id=$theCause.getTargetHazardID()&gt;:&lt;ALL CAUSES&gt;
																#else
																	(TRANSFER) $theCause.getTargetHazardNumber():&lt;ALL CAUSES&gt;
																#end
																
																#if ($theCause.isDeleted() == true)
																	</div>
																#else
																	</a>
																#end
															#end
														#end
													#end
												</span>
											</div>
											#set( $activeCauses = 0 )
											#if ($cause.getControls() )
											<ul>												
												#foreach ($control in $cause.getControls())
													#if( !$control.getDeleteReason() || $control.getDeleteReason().isEmpty() )
													<li>
														#set( $activeCauses = $activeCauses + 1 )
														#if( $control.getTransfer() != 0)
															#parse("/templates/control-existing-transfer.vm")
														#else
															#parse("/templates/control-existing-regular.vm")
														#end
													</li>
													#end												
												#end
											</ul>
											#end
											#if($activeCauses == 0)
												<span class="noControlsMessage">No controls for this cause.</span>
											#end
										</li>
										#end
									#end
									#if($orphanControls.size() > 0 )
										<li>
											<div class="causeHeader" id="orphanControls">
												<span class="VerificationCauseTableToggle aui-icon aui-icon-small aui-iconfont-devtools-task-disabled">Expand/collapse this cause</span>
												<span class="causeNumber">Orphan Controls ($orphanControls.size())</span>												
											</div>

											<ul>												
												#foreach ($control in $orphanControls)
												<li>																								
													#if( !$control.getDeleteReason() || $control.getDeleteReason().isEmpty() )
														#set( $activeCauses = $activeCauses + 1 )
														#if( $control.getTransfer() != 0)
															#parse("/templates/control-existing-transfer.vm")
														#else
															#parse("/templates/control-existing-regular.vm")
														#end
													#end
												</li>
												#end
											</ul>
										</li>
									#end
								</ul>								
								<div class="HazardPropertyTableButtonsContainer">
									<input class="aui-button ControlPageSaveAllChanges" type="button" value="Save All Changes" data-ops="all">
									<input class="aui-button" type="button" value="Renumber &amp; Save" style="margin: 0" disabled>
									<input class="aui-button" type="button" value="Expand All" id="ControlPageExpandAllButton" style="margin: 0">
									<input class="aui-button" type="button" value="Close All" id="ControlPageCloseAllButton" style="margin: 0">
								</div>
							#end
							<div>
								<div class="HazardPropertyHeadingTwo">
									<span class="aui-icon aui-icon-small aui-iconfont-add" id="AddNewVerification"></span>
									<span>Add New Verification</span>
								</div>
								<div id="VerificationPageNewContainer">
									#parse("/templates/verification-new.vm")
								</div>
								<div class="HazardPropertyHeadingTwo">
									<span class="aui-icon aui-icon-small aui-iconfont-add" id="VerificationPageAddTransfer"></span>
									<span>Add Verification Transfer</span>
								</div>
								<div id="VerificationPageTransferContainer">
									Add a new transfer here
									##parse("/templates/verification-transfer.vm")
								</div>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>